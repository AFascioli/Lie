<h1 *ngIf="rolConPermisosEdicion" class="componente-titulo">
  Registrar calificaciones
</h1>
<h1 *ngIf="!rolConPermisosEdicion" class="componente-titulo">
  Visualizar calificaciones
</h1>

<mat-card class="card-body-componente">
  <form #form="ngForm">
    <div class="div-selects">
      <mat-form-field>
        <mat-select
          name="trimestre"
          ngModel
          #trimestre="ngModel"
          matNativeControl
          required
          placeholder="Seleccione trimestre"
          name="trimestre"
          [(ngModel)]="trimestrePorDefecto"
          (selectionChange)="obtenerNotas(form)"
        >
          <mat-option value="1">Primer</mat-option>
          <mat-option value="2">Segundo</mat-option>
          <mat-option value="3">Tercer</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field>
        <mat-select
          placeholder="Seleccione curso"
          name="curso"
          ngModel
          #curso="ngModel"
          matNativeControl
          required
          (selectionChange)="onCursoSeleccionado(curso)"
        >
          <mat-option *ngFor="let objCurso of cursos" [value]="objCurso.id">
            {{ objCurso.curso }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-select
          placeholder="Seleccione materia"
          name="materia"
          ngModel
          #materia="ngModel"
          matNativeControl
          required
          (selectionChange)="obtenerNotas(form)"
        >
          <mat-option
            *ngFor="let objMateria of materias"
            [value]="objMateria.id"
          >
            {{ objMateria.nombre }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <table mat-table [dataSource]="estudiantes" *ngIf="estudiantes">
      <ng-container matColumnDef="apellido">
        <th class="columnasNormales" mat-header-cell *matHeaderCellDef>
          Apellido/s
        </th>
        <td class="columnasNormales" mat-cell *matCellDef="let estudiante">
          {{ estudiante.apellido }}
        </td>
      </ng-container>

      <ng-container matColumnDef="nombre">
        <th class="columnasNormales" mat-header-cell *matHeaderCellDef>
          Nombre/s
        </th>
        <td class="columnasNormales" mat-cell *matCellDef="let estudiante">
          {{ estudiante.nombre }}
        </td>
      </ng-container>

      <ng-container matColumnDef="cal1">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>1°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[0]"
            name="nota1{{ estudiante.calificaciones[0] }}"
            type="number"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[0] }}
          </p>
        </td>
      </ng-container>
      <ng-container matColumnDef="cal2">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>2°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[1]"
            type="number"
            name="nota2{{ estudiante.calificaciones[1] }}"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[1] }}
          </p>
        </td>
      </ng-container>
      <ng-container matColumnDef="cal3">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>3°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[2]"
            type="number"
            name="nota3{{ estudiante.calificaciones[2] }}"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[2] }}
          </p>
        </td>
      </ng-container>
      <ng-container matColumnDef="cal4">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>4°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[3]"
            type="number"
            name="nota4{{ estudiante.calificaciones[3] }}"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[3] }}
          </p>
        </td>
      </ng-container>
      <ng-container matColumnDef="cal5">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>5°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[4]"
            type="number"
            name="nota5{{ estudiante.calificaciones[4] }}"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[4] }}
          </p>
        </td>
      </ng-container>
      <ng-container matColumnDef="cal6">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>6°</th>
        <td class="columnasChicas" mat-cell *matCellDef="let estudiante">
          <input
            *ngIf="rolConPermisosEdicion"
            [(ngModel)]="estudiante.calificaciones[5]"
            type="number"
            name="nota6{{ estudiante.calificaciones[5] }}"
            pattern="([0-9]|10)"
          />
          <p *ngIf="!rolConPermisosEdicion">
            {{ estudiante.calificaciones[4] }}
          </p>
        </td>
      </ng-container>

      <ng-container matColumnDef="prom">
        <th class="columnasChicas" mat-header-cell *matHeaderCellDef>
          Promedio
        </th>
        <td
          class="columnasChicas promedio"
          mat-cell
          *matCellDef="let estudiante; let i = index"
        >
          <p *ngIf="!(contadorNotasValidas(i) == 0); else sinNotas">
            {{
              (
                (estudiante.calificaciones[0] +
                  estudiante.calificaciones[1] +
                  estudiante.calificaciones[2] +
                  estudiante.calificaciones[3] +
                  estudiante.calificaciones[4] +
                  estudiante.calificaciones[5]) /
                contadorNotasValidas(i)
              ).toFixed(2)
            }}
          </p>
          <ng-template #sinNotas>0</ng-template>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div class="div-button">
      <button
        [disabled]="!estudiantes"
        mat-raised-button
        class="button"
        (click)="onGuardar(form)"
        class="buttonPrimary"
      >
        Guardar
      </button>
      <button mat-raised-button class="buttonWarn" (click)="onCancelar()">
        Cancelar
      </button>
    </div>
  </form>
</mat-card>
